<!DOCTYPE html>

<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>登录</title>
    <link rel="stylesheet" href="./css/login.css">
    <script src="./js/jquery-3.7.1.min.js"></script>
    <script src="./js/jquery.cookie.js"></script>
    <script>
        $(document).ready(function () {
            $("#rememberPwd+label").click(function () {
                $(this).toggleClass("unchecked");
                $(this).toggleClass("checked");
            });
            const identification = $.cookie("identification");
            const defaultPwd = $.cookie("defaultPwd");
            if (identification) {
                $(".id").val(identification);
                $(".password").val(defaultPwd);
            }
            $(".login-btn").click(() => {
                const id = $(".id").val();
                const password = $(".password").val();
                if (id == "" || password == "") {
                    alert("身份证号或密码不能为空!");
                    return;
                }
                $.ajax({
                    url: "http://www.dony.cn:5000/login",
                    type: "post",
                    data: {
                        "id": id
                    },
                    success: (result) => {
                        if (result == password) {
                            if ($("#rememberPwd+label").attr("class") == "checked") {
                                $.cookie("identification", id, { expires: 60, path: "/" });
                                $.cookie("defaultPwd", password, { expires: 60, path: "/" });
                                window.location.href = "/list.html";
                            }
                            else {
                                $.removeCookie("identification", { path: "/" });
                                $.removeCookie("defaultPwd", { path: "/" });
                            }
                            localStorage.setItem("id", id);
                        }
                        else {
                            alert("登录失败，请检查身份证号或密码是否有误");
                        }
                    },
                    error: () => {
                        alert("不存在此账户!");
                    }
                });
            });

        });
    </script>
</head>

<body>
    <div class="main-wrapper">
        <div class="header">
            <img src="./img/DONYLOGO.jpg" alt="DONY" class="logo">
        </div>

        <div class="container">
            <div class="card">
                <div class="card_body">
                    <h1 class="login-title">登录</h1>

                    <form action="/" method="post" class="login-form">
                        <div class="form-group">
                            <label for="id">身份证号</label>
                            <input class="info id" type="text" id="id" placeholder="请输入身份证号">
                        </div>

                        <div class="form-group">
                            <label for="password">密码</label>
                            <input class="info password" type="password" id="password" placeholder="请输入密码">
                        </div>

                        <div class="form-options">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" name="rememberPwd" id="rememberPwd" checked>
                                <label class="checked" for="rememberPwd">记住密码</label>
                            </div>
                            <a href="./forgetPwd.html" class="forgetPwd">忘记密码?</a>
                        </div>

                        <button type="button" class="login-btn">登录</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="footer">
            <span class="footer-text">没有账号?</span>
            <a class="signUp" href="./signUp.html">马上注册</a>
        </div>
    </div>
</body>

</html>